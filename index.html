<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Form Pelaporan Divisi - Upload Base64</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    input, textarea, select { width: 100%; margin-top: 8px; padding: 8px; margin-bottom: 12px; }
    .activity { border: 1px solid #ddd; padding: 10px; margin-top: 10px; }
    button { background-color: orange; color: white; padding: 10px; border: none; width: 100%; }
  </style>
</head>
<body>
  <h2>Form Laporan Harian (Upload Gambar Base64)</h2>
  <form id="form">
    <label>Tanggal</label><input name="tanggal" type="date" required>
    <label>Divisi</label>
    <select name="divisi" required>
      <option value="">-- Pilih --</option>
      <option>Operasional Kribangs</option>
      <option>Operasional Cemilan</option>
      <option>Finance</option>
      <option>HRD</option>
      <option>Kanvas/Kampas</option>
    </select>
    <label>Nama PIC</label><input name="nama" required>
    <label>Goal Harian</label><input name="goal">
    <label>Perintah Kerja</label><textarea name="perintah"></textarea>

    <div id="activity-list"></div>
    <button type="button" onclick="addActivity()">+ Tambah Aktivitas</button>
    <button type="submit">Kirim Laporan</button>
  </form>

  <script>
    let activityCount = 0;
    function addActivity() {
      activityCount++;
      const container = document.getElementById("activity-list");
      const div = document.createElement("div");
      div.className = "activity";
      div.innerHTML = `
        <h4>Aktivitas ${activityCount}</h4>
        <input name="aktivitas${activityCount}" placeholder="Aktivitas">
        <select name="status${activityCount}">
          <option value="Selesai">Selesai</option>
          <option value="Belum Selesai">Belum Selesai</option>
        </select>
        <textarea name="kendala${activityCount}" placeholder="Kendala"></textarea>
        <textarea name="solusi${activityCount}" placeholder="Solusi"></textarea>
        <textarea name="lanjut${activityCount}" placeholder="Tindakan Lanjut"></textarea>
        <input type="file" name="gambar${activityCount}" accept="image/*" onchange="encodeImageToBase64(this, ${activityCount})">
        <input type="hidden" name="imageBase64${activityCount}" id="imageBase64${activityCount}">
      `;
      container.appendChild(div);
    }

    function encodeImageToBase64(input, index) {
      const file = input.files[0];
      const reader = new FileReader();
      reader.onloadend = function () {
        document.getElementById("imageBase64" + index).value = reader.result;
      };
      if (file) reader.readAsDataURL(file);
    }

    document.getElementById("form").onsubmit = async function(e) {
      e.preventDefault();
      const formData = new FormData(e.target);
      formData.append("activityCount", activityCount);

      const json = {};
      formData.forEach((value, key) => json[key] = value);

      await fetch("https://script.google.com/macros/s/AKfycbzQEHumJ8D-Bhp3_9rRTaSN7zYNAbsyiks2BTYkQxNEAAXFh0L8Z-bKqjQtfqghEpUG/exec", {
        method: "POST",
        body: JSON.stringify(json),
        headers: { "Content-Type": "application/json" }
      });

      alert("Terkirim!");
      e.target.reset();
      document.getElementById("activity-list").innerHTML = "";
      activityCount = 0;
      addActivity();
    };

    addActivity();
  </script>
</body>
</html>
